schema_version: 1

context:
  name: ada-py
  version: "0.7.10"
  python_min: 3.11

recipe:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://github.com/Krande/adapy/archive/v${{ version }}.tar.gz
  sha256: 19827c9f3c8a2e751823bad95a1c2ef1b9df99f2d22180e7585487d84aa3a6d0

build:
  number: 1

outputs:
  - package:
      name: ${{ name }}-core
    build:
      noarch: python
      script: python -m pip install . --no-deps -vv
      python:
        entry_points:
          - ada-viewer=ada.visit.websocket_cli:ws_cli_app
    requirements:
      host:
        - pip
        - setuptools
        - python ${{ python_min }}.*
    about:
      description: |
        The core package without dependencies of ADAPY, a python library for structural analysis and design.

  - package:
      name: ${{ name }}
    build:
      noarch: python

    requirements:
      run:
        - python >=${{ python_min }}
        - numpy
        - hdf5
        - h5py
        - ifcopenshell
        - bcf-client
        - pythonocc-core
        - python-gmsh
        - pyquaternion
        - trimesh
        - occt >=7.7.2
        - send2trash
        - meshio
        - websockets
        - plotly
        - python-kaleido
        - pydantic
        - ipywidgets
        - jupyterlab
        - pyparsing
        - pyglfw
        - pygfx
        - python-flatbuffers
        - ${{ pin_subpackage("ada-py-core", exact=True) }}
    tests:
      - python:
          imports:
            - ada
          pip_check: false
          python_version: ${{ python_min }}.*
      - files:
          source:
            - tests
            - files
        requirements:
          run:
            - python ${{ python_min }}.*
            - pytest
            - pytest-cov
            - pytest-asyncio
            - calculix
        script:
          - pytest tests --ignore=tests/fem --ignore=tests/profiling --ignore=tests/examples --ignore=tests/full/frontend --cov=ada --cov-report=xml --ignore=tests/core/visit/plotting/test_easy_plotly.py

about:
  license: GPL-3.0-or-later
  license_file: LICENSE
  summary: A python library for structural analysis and design
  homepage: https://github.com/krande/adapy
  documentation: https://krande.github.io/adapy/

extra:
  recipe-maintainers:
    - Krande
