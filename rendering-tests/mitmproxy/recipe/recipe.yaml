schema_version: 1

context:
  version: "12.2.1"
  python_min: "3.12"

package:
  name: mitmproxy
  version: ${{ version }}

source:
  url: https://github.com/mitmproxy/mitmproxy/archive/v${{ version }}.tar.gz
  sha256: 73a131a533a163ac4d9da7695d0bf0c19422c2b47757c39da4833257732fdb90

build:
  number: 0
  noarch: python
  script:
    - ${{ PYTHON }} -m pip install -vv --no-deps --no-build-isolation .
  python:
    # if ommitted, the windows tests fail
    entry_points:
      - mitmproxy = mitmproxy.tools.main:mitmproxy
      - mitmdump = mitmproxy.tools.main:mitmdump
      - mitmweb = mitmproxy.tools.main:mitmweb

requirements:
  host:
    - python ${{ python_min }}.*
    - pip
    - setuptools
  run:
    - python >=${{ python_min }}
    - aioquic >=1.2.0,<=1.2.0 # sic (see upstream pyproject.toml)
    - argon2-cffi >=23.1.0,<=25.1.0
    - asgiref >=3.2.10,<=3.10.0
    - bcrypt >=5.0.0,<=5.0.0
    - brotli-python >=1.0,<=1.2.0
    - certifi >=2019.9.11
    - cryptography >=42.0,<=46.1
    - flask >=3.0,<=3.1.2
    - h11 >=0.16.0,<=0.16.0
    - h2 >=4.3.0,<=4.3.0
    - hyperframe >=6.0,<=6.1.0
    - kaitaistruct >=0.10,<=0.11
    - ldap3 >=2.8,<=2.9.1
    - mitmproxy-rs >=0.12.6,<0.13
    - msgpack-python >=1.0.0,<=1.1.2
    - if: win
      then:
        - __win
        - pydivert >=2.0.3,<=2.1.0
    - if: unix
      then:
        - __unix
    - pyopenssl >=24.3,<=25.3.0
    - pyparsing >=2.4.2,<=3.2.5
    - pyperclip >=1.9.0,<=1.11.0
    - ruamel.yaml >=0.18.10,<=0.18.16
    - sortedcontainers >=2.3,<=2.4.0
    - tornado >=6.5.0,<=6.5.2
    - typing-extensions >=4.13.2,<=4.14
    - urwid >=2.6.14,<=3.0.3
    - wsproto >=1.0,<=1.2.0
    - publicsuffix2 >=2.20190812,<=2.20191221
    - zstandard >=0.25,<=0.25.0

tests:
  - python:
      imports:
        - mitmproxy
      python_version: ${{ python_min }}.*
  - requirements:
      run:
        - pip
        - python ${{ python_min }}.*
    script:
      - mitmproxy --version
      - mitmdump --version
      - mitmweb --version

about:
  summary: An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.
  license: MIT
  license_file:
    - LICENSE
  homepage: http://mitmproxy.org

extra:
  recipe-maintainers:
    - wolfv
    - jonashaag
    - AdrianFreundQC
    - freundTech
    - moritzwilksch
    - ytausch
