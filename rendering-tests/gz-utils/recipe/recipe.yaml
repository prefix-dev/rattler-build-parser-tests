schema_version: 1

context:
  component_name: utils
  repo_name: gz-utils
  version: 4.0.0
  major_version: 4
  name: gz-utils
  cxx_name: libgz-utils

recipe:
  name: gz-utils-split
  version: ${{ version }}

source:
  - url: https://github.com/gazebosim/${{ repo_name }}/archive/${{ repo_name }}${{ major_version }}_${{ version }}.tar.gz
    sha256: b06a179ea4297be8b8d09ea7a5d3d45059a3e4030c1bd256afc62f997cc992ed

build:
  number: 2

outputs:
  - package:
      name: ${{ cxx_name }}
    build:
      script:
        - if: unix
          then: build_cxx.sh
        - if: win
          then: bld_cxx.bat
    requirements:
      build:
        - ${{ compiler('cxx') }}
        - ${{ compiler('c') }}
        - ${{ stdlib('c') }}
        - cmake
        - ninja
        - pkgconfig
      host:
        - libgz-cmake
        - cli11
        - spdlog
      run:
        - cli11
      run_exports:
        - ${{ pin_subpackage(cxx_name, upper_bound='x') }}
    tests:
      - requirements:
          run:
            - cmake-package-check
            - ${{ compiler('c') }}
            - ${{ compiler('cxx') }}
        script:
          - cmake-package-check gz-utils --targets gz-utils::gz-utils
          - if: not win
            then:
              - test -f ${PREFIX}/include/gz/${{ component_name }}${{ major_version }}/gz/${{ component_name }}.hh
              - test -f ${PREFIX}/lib/lib${{ name }}$SHLIB_EXT
              - test -f ${PREFIX}/lib/lib${{ name }}-log$SHLIB_EXT
              - test -f ${PREFIX}/lib/cmake/${{ name }}/${{ name }}-config.cmake
            else:
              - if not exist %PREFIX%\\Library\\include\\gz\\${{ component_name }}${{ major_version }}\\gz\\${{ component_name }}.hh exit 1
              - if not exist %PREFIX%\\Library\\lib\\${{ name }}.lib exit 1
              - if not exist %PREFIX%\\Library\\bin\\${{ name }}.dll exit 1
              - if not exist %PREFIX%\\Library\\lib\\cmake\\${{ name }}\\${{ name }}-config.cmake exit 1
              - if not exist %PREFIX%\\Library\\lib\\${{ name }}-log.lib exit 1
              - if not exist %PREFIX%\\Library\\bin\\${{ name }}-log.dll exit 1
  - package:
      name: ${{ name }}
    requirements:
      run:
        - ${{ pin_subpackage(cxx_name, exact=True) }}
      run_exports:
        - ${{ pin_subpackage(cxx_name, upper_bound='x') }}
    tests:
      - script:
          - if: not win
            then:
              - test -f ${PREFIX}/include/gz/${{ component_name }}${{ major_version }}/gz/${{ component_name }}.hh
              - test -f ${PREFIX}/lib/cmake/${{ name }}/${{ name }}-config.cmake
          - if: linux
            then:
              - test -f ${PREFIX}/lib/lib${{ name }}.so
          - if: osx
            then:
              - test -f ${PREFIX}/lib/lib${{ name }}.dylib
          - if: win
            then:
              - if not exist %PREFIX%\\Library\\include\\gz\\${{ component_name }}${{ major_version }}\\gz\\${{ component_name }}.hh exit 1
              - if not exist %PREFIX%\\Library\\lib\\${{ name }}.lib exit 1
              - if not exist %PREFIX%\\Library\\bin\\${{ name }}.dll exit 1
              - if not exist %PREFIX%\\Library\\lib\\cmake\\${{ name }}\\${{ name }}-config.cmake exit 1

about:
  homepage: https://github.com/gazebosim/${{ repo_name }}
  license: Apache-2.0
  license_file: LICENSE
  summary: Classes and functions for robot applications.

extra:
  recipe-maintainers:
    - wolfv
    - traversaro
    - Tobias-Fischer
