context:
  name: tectonic
  version: 0.15.0
  sha256: 3c13de312c4fe39ff905ad17e64a15a3a59d33ab65dacb0a8b9482c57e6bc6aa

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/tectonic-typesetting/${{ name }}/archive/refs/tags/${{ name }}@${{ version }}.tar.gz
  sha256: ${{ sha256 }}
  patches:
    - pr-1202-fix-use-cxx-17.patch
    - fix-autoref.patch
    - if: win
      then: winzip.patch

build:
  number: 5

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - ${{ compiler('cxx') }}
    - ${{ compiler('rust') }}
    - cargo-bundle-licenses
    - if: win
      then:
        - m2w64-pkg-config
      else:
        - pkg-config
    - if: build_platform != target_platform
      then:
        - glib
        - harfbuzz
  host:
    - if: not osx
      then:
        - expat
        - fontconfig
    - freetype
    - glib  # development files needed by harfbuzz
    - graphite2
    - harfbuzz
    - icu
    - libpng
    - openssl
    - zlib
  run:
    - if: not osx
      then:
        - fontconfig
    - freetype
    - graphite2
    - harfbuzz
    - icu
    - libpng
    - openssl
    - zlib

tests:
  - files:
      recipe:
        - example.tex
    script:
      - tectonic --help
      - tectonic example.tex

about:
  license: MIT
  license_file:
    - LICENSE
    - THIRDPARTY.yml
  summary: A modernized, complete, standalone TeX/LaTeX engine.
  homepage: https://tectonic-typesetting.github.io/
  repository: https://github.com/tectonic-typesetting/tectonic/
  documentation: https://tectonic-typesetting.github.io/book/latest/

extra:
  recipe-maintainers:
    - pkgw
    - anjos
