schema_version: 1

context:
  name: ldas-tools-frameAPI
  version: 3.0.5
  ldas_tools_cmake_version: 1.3.0
  ldas_tools_al_version: 2.7.0
  ldas_tools_framecpp_version: 3.0.5
  ldas_tools_filters_version: 2.6.6
  ldas_tools_ldasgen_version: 2.7.4

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: http://software.ligo.org/lscsoft/source/${{ name }}-${{ version }}.tar.gz
  sha256: e56a4714b980ab117cebb3b99f25fd9a3c90672ca5ab971cdd77ac157c56ddc7

build:
  dynamic_linking:
    missing_dso_allowlist:
      - if: osx
        then: /usr/lib/libSystem.B.dylib
    overdepending_behavior: error
    overlinking_behavior: error
  number: 0
  skip: win

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib("c") }}
    - ${{ compiler('cxx') }}
    - cmake >=3.6
    - if: unix
      then:
        - make
        - pkg-config
  host:
    - ldas-tools-al >=${{ ldas_tools_al_version }}
    - ldas-tools-cmake >=${{ ldas_tools_cmake_version }}
    - ldas-tools-filters >=${{ ldas_tools_filters_version }}
    - ldas-tools-framecpp >=${{ ldas_tools_framecpp_version }}
    - ldas-tools-ldasgen >=${{ ldas_tools_ldasgen_version }}
    - libboost-devel
  run_exports:
    - ${{ pin_subpackage("ldas-tools-frameapi", upper_bound="x.x") }}

tests:
  - requirements:
      run:
        - if: unix
          then:
            - pkg-config
    script:
      - framecpp_sample
      - "ldas_analysis_ready --frame-file-pattern \"*.gwf\" --ifo Z0 --analysis-ready-channel RAMPED_INT_8U_1"
      - if: unix
        then:
          - test -d ${PREFIX}/include/frameAPI
          - pkg-config --print-errors --exact-version ${{ version }} ldastools-ldasframe

about:
  license: GPL-2.0-or-later
  license_file: COPYING
  summary: LDAS tools frameAPI library
  description: This provides the runtime libraries for the frameAPI library.
  homepage: https://wiki.ligo.org/Computing/LDASTools
  repository: https://git.ligo.org/ldastools/LDAS_Tools

extra:
  recipe-maintainers:
    - duncanmmacleod
    - emaros
