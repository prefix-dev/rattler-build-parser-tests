context:
  version: "1.2.11"

package:
  name: sqlit-tui
  version: ${{ version }}

source:
  - url: https://pypi.org/packages/source/s/sqlit-tui/sqlit_tui-${{ version }}.tar.gz
    sha256: e53320b07520fc1284e25d7b98c65923ad8be0000dec1b0b6d465cee41445501

build:
  number: 0
  script: ${{ PYTHON }} -m pip install .
  python:
    entry_points:
      - sqlit = sqlit.cli:main
  noarch: python

requirements:
  host:
    - python ${{ python_min }}.*
    - hatchling
    - hatch-vcs
    - pip
  run:
    - python >=${{ python_min }}
    - textual >=6.10.0
    # for textual[syntax], has run_constrained on textual:
    - tree_sitter
    - tree_sitter_languages
    - tree-sitter-sql
    - textual-fastdatatable >=0.14.0
    - pyperclip >=1.8.2
    - keyring >=24.0.0
    - docker-py >=7.0.0
    - sqlparse >=0.5.0

tests:
  - python:
      imports:
        - sqlit
      pip_check: true
      python_version: ${{ python_min }}.*
  - script:
      - sqlit --help
  - script:
      - |
        bash -c '
        set -o pipefail

        # Run the TUI briefly and capture output
        timeout 5s sqlit --mock=sqlite-demo 2>&1 | tee output.log
        status=$?

        # timeout exit code 124 is expected and OK
        if [ "$status" -ne 0 ] && [ "$status" -ne 124 ]; then
          exit "$status"
        fi

        # Fail only if real errors are present
        if grep -iE "traceback|exception" output.log; then
          exit 1
        fi

        exit 0
        '


about:
  summary: The lazygit of SQL databases
  description: |
    A terminal UI for SQL Server, PostgreSQL, MySQL, SQLite, Oracle, and more
    Connect and query your database from your terminal in seconds.

    Supports all major databases: SQL Server, PostgreSQL, MySQL, SQLite, MariaDB, FirebirdSQL, Oracle, DuckDB, CockroachDB, ClickHouse, Snowflake, Supabase, CloudFlare D1, and Turso.

    Syntax highlighting. History. Vim-style keybindings.
  homepage: https://github.com/Maxteabag/sqlit
  license: MIT
  license_file: LICENSE

extra:
  recipe-maintainers:
    - claudiushaag
