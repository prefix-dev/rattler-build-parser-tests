context:
  name: librerun-sdk
  version: "0.28.2"

package:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://github.com/rerun-io/rerun/archive/refs/tags/${{ version }}.tar.gz
  sha256: 2219adb75e7c608a2969cfbe866106ad6c23cd72c26a38116cfa4318842beae8

build:
  number: 0
  script:
    - if: win
      then: call "%RECIPE_DIR%\\build.bat"
    - if: unix
      then: bash "${RECIPE_DIR}/build.sh"

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - ${{ compiler('cxx') }}
    - cmake >=3.29
    - pkg-config
    - ninja
    - cargo-bundle-licenses
    - ${{ compiler('rust') }}
    - if: osx
      then:
        - lld
  host:
    - libarrow
  run_constraints:
    - rerun-sdk ${{ version }}.*
  run_exports:
    - ${{ pin_subpackage(name, upper_bound='x.x.x') }}
tests:
  - files:
      recipe:
        - run_test.bat
        - run_test.sh
      source:
        - examples/cpp
    requirements:
      run:
        - cmake-package-check
        - ${{ compiler('c') }}
        - ${{ compiler('cxx') }}
        - cmake
        - ninja
    script:
      - if: unix
        then:
          - test -f "${PREFIX}/include/rerun.hpp"
          - test -f "${PREFIX}/lib/librerun_sdk${SHLIB_EXT}"
          - cmake-package-check rerun_sdk --targets rerun_sdk
          - bash "run_test.sh"
      - if: win
        then:
          - if not exist "%LIBRARY_PREFIX%\\include\\rerun.hpp" exit 1
          - if not exist "%LIBRARY_PREFIX%\\lib\\rerun_sdk.lib" exit 1
          - if not exist "%LIBRARY_PREFIX%\\bin\\rerun_sdk.dll" exit 1
          - cmake-package-check rerun_sdk --targets rerun_sdk
          - call "run_test.bat"

about:
  homepage: https://www.rerun.io/
  summary: Rerun is an SDK for logging computer vision and robotics data paired with a visualizer for exploring that data over time.
  description: |
    The `librerun-sdk` package provides the C++ API for Rerun, while `rerun-sdk` provides the Python API.
  license: MIT OR Apache-2.0
  license_file:
    - THIRDPARTY.yml
    - LICENSE-MIT
    - LICENSE-APACHE
  documentation: https://www.rerun.io/docs
  repository: https://github.com/rerun-io/rerun

extra:
  recipe-maintainers:
    - jeongseok-meta
    - traversaro
    - jleibs
