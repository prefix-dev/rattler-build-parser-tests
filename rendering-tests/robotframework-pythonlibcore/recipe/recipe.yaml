# yaml-language-server: $schema=https://raw.githubusercontent.com/prefix-dev/recipe-format/main/schema.json
schema_version: 1

context:
  version: "4.5.0"
  python_check_max: "3.14"
  # space-delimited paths to undiscoverable test tiles
  ## - test_get_keyword_source.py needs pytest-mockito
  test_rm: utest/test_get_keyword_source.py
  test_cov_run: coverage run --source=robotlibcore --branch
  test_cov_fail_under: "85"

package:
  name: robotframework-pythonlibcore
  version: ${{ version }}

source:
  - target_directory: dist
    url: https://pypi.org/packages/source/r/robotframework-pythonlibcore/robotframework_pythonlibcore-${{ version }}.tar.gz
    sha256: 54ad47c592b2959bffe865e006fd4517f3c46dfb9df5b68a3f335ab842ab065e
  - target_directory: src
    url: https://github.com/robotframework/PythonLibCore/archive/refs/tags/v${{ version }}.tar.gz
    sha256: 08ea0c1b04d207557d3dda6c2afbcd2cf31d7b344ee75e02a4a6afe3380d7893

build:
  number: 1
  noarch: python
  script:
    - cd dist
    - ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation --disable-pip-version-check

requirements:
  host:
    - pip
    - python ${{ python_min }}.*
    - setuptools
  run:
    - python >=${{ python_min }}
    - robotframework

tests:
  - python:
      imports: robotlibcore
      pip_check: true
      python_version:
        - ${{ python_min }}.*
        - ${{ python_check_max }}.*
  - files:
      source:
        - src/utest
        - src/atest
    requirements:
      run:
        - approvaltests >=11.1.1
        - coverage
        - pytest
        - python ${{ python_min }}.*
        - robotframework
        - robotstatuschecker
        # needs packaging
        # - pytest-mockito
    script:
      - cd src
      - ${{ ("del " if win else "rm ") ~ test_rm if test_rm else "echo no tests deleted" }}
      - if: unix
        then: export "PYTHONPATH=$(pwd)/atest:$(pwd)/utest/helpers"
        else: set "PYTHONPATH=%cd%\atest;%cd%\utest\helpers"
      - echo "tool.coverage.run.patch = ['subprocess']" > pyproject.toml
      - ${{ test_cov_run }} -m pytest -vv --tb=long --color=yes
      - ${{ test_cov_run }} atest/run.py
      - coverage combine
      - coverage report --show-missing --skip-covered --fail-under=${{ test_cov_fail_under }}

about:
  summary: Tools to ease creating larger test libraries for Robot Framework using Python.
  license: Apache-2.0
  license_file:
    - dist/LICENSE.txt
    - dist/COPYRIGHT.txt
  homepage: https://pypi.org/project/robotframework-pythonlibcore
  repository: https://github.com/robotframework/PythonLibCore
  description: |-
    The Robot Framework hybrid and dynamic library API gives more flexibility for
    library than the static library API, but they also sets requirements for
    libraries which needs to be implemented in the library side. PythonLibCore
    eases the problem by providing simpler interface and handling all the
    requirements towards the Robot Framework library APIs.

extra:
  recipe-maintainers:
    - bollwyvl
    - martinRenou
