context:
  name: arbalister
  version: "0.2.0"
  python_min: "3.12"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://pypi.org/packages/source/${{ name[0] }}/${{ name }}/${{ name }}-${{ version }}.tar.gz
  sha256: 6065df0c96db99304c41ec1d5e04e9a27d225139dc3610597c12424c8a191e6e

build:
  number: 0
  noarch: python
  script: pip install --no-deps --no-build-isolation -vv .

requirements:
  build:
    - nodejs
  host:
    - python ${{ python_min }}.*
    - pip
    - hatchling >=1.5.0
    - jupyterlab >=4.0.0,<5
    - hatch-nodejs-version >=0.3.2
    - hatch-jupyter-builder >=0.5
  run:
    - python >=${{ python_min }}
    - jupyter_server >=2.4.0,<3
    - pyarrow >=20.0
    - datafusion >=40.0
tests:
  - package_contents:
      files:
        exists:
          - share/jupyter/labextensions/arbalister/install.json
          - etc/jupyter/jupyter_server_config.d/arbalister.json
  # Jupyterlab, despite needed for this import should not be a dependency since it is typically
  # it that is doing the loading
  - script:
      - python -c "import arbalister; print('Python arbalister import sucessful');"
      - pip check
    requirements:
      run:
        - python ${{ python_min }}.*
        - pip
        - jupyterlab >=4.5
        # TODO Were not properly marked as optional in 0.2.0 but were handled as such
        - adbc-driver-manager
        - adbc-driver-sqlite

about:
  homepage: https://github.com/QuantStack/Arbalister/
  summary: Dataframe viewer for Jupyter over Arrow
  description: |
    This viewer lets you double click on many file types supported in the Apache Arrow ecosystem to
    automatically view it as tabular data (Csv, Parquet, Avro, Orc, Ipc).

    For library authors, the server extension serves files in the Arrow IPC stream format.
    It can be reused to provide other type of application specific viewers (e.g. as time series,
    ...).
  license: BSD-3-Clause
  license_file: LICENSE
  documentation: https://github.com/QuantStack/Arbalister/
  repository: https://github.com/QuantStack/Arbalister/

extra:
  recipe-maintainers:
    - AntoinePrv
