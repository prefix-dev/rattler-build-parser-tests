schema_version: 1

context:
  name: dulwich
  version: 1.0.0

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://pypi.org/packages/source/${{ name[0] }}/${{ name }}/dulwich-${{ version }}.tar.gz
  sha256: 3d07104735525f22bfec35514ac611cf328c89b7acb059316a4f6e583c8f09bc

build:
  number: 1
  script: 
    - cargo-bundle-licenses --format yaml --output THIRDPARTY.yml
    - ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
  python:
    entry_points:
      - dulwich = dulwich.cli:main

requirements:
  build:
    - if: build_platform != target_platform
      then: 
        - python
        - cross-python_${{ target_platform }}
    - ${{ compiler('c') }}
    - ${{ compiler('rust') }}
    - ${{ stdlib("c") }}
    - cargo-bundle-licenses
  host:
    - python
    - setuptools >=77.0.0
    - setuptools-rust
    - pip
  run:
    - python
    - urllib3 >=2.2.2
    - if: match(python, ">=3.12")
      then: setuptools
    - if: match(python, "<=3.11")
      then: typing_extensions >=4.6.0

tests:
  - python:
      imports:
        - dulwich
        - dulwich.tests
        - dulwich.archive
        - dulwich.client
        - dulwich.config
        - dulwich.diff_tree
        - dulwich.errors
        - dulwich.file
        - dulwich.hooks
        - dulwich.ignore
        - dulwich.index
        - dulwich.object_store
        - dulwich.objects
        - dulwich.objectspec
        - dulwich.pack
        - dulwich.patch
        - dulwich.protocol
        - dulwich.reflog
        - dulwich.refs
        - dulwich.repo
        - dulwich.server
        - dulwich.walk
        - dulwich.web
      pip_check: true
  - script:
      - dulwich help --all

about:
  license: Apache-2.0
  license_file: 
    - COPYING
    - THIRDPARTY.yml
  summary: Python Git Library
  description: |
    Python implementation of the Git file formats and protocols, without the need to have git installed.
    All functionality is available in pure Python. Optional C extensions can be built for improved performance.
    The project is named after the part of London that Mr. and Mrs. Git live in in the particular Monty Python sketch.
  homepage: https://www.dulwich.io/
  repository: https://github.com/jelmer/dulwich
  documentation: https://www.dulwich.io/docs/

extra:
  recipe-maintainers:
    - mikofski
    - xylar
