context:
  name: csp-gateway
  version: "2.4.4"

recipe:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://pypi.org/packages/source/c/csp-gateway/csp_gateway-${{ version }}.tar.gz
  sha256: d6faba165311f96ea137abc7892babca15f60dfc40e903c0cba69f0ff19aa052

build:
  number: 0

outputs:
  - package:
      name: ${{ name|lower }}
    build:
      noarch: python
      script: python -m pip install . -vv --no-deps --no-build-isolation
      python:
        entry_points:
          - cspgateway-start = csp_gateway.server.cli:main
          - cspgateway_start = csp_gateway.server.cli:main
          - csp-gateway-start = csp_gateway.server.cli:main
          - csp_gateway_start = csp_gateway.server.cli:main
    requirements:
      host:
        - python ${{ python_min }}.*
        - pip
        - hatchling
        - hatch-js
        - hatch-multi
        - pnpm
      run:
        - python >=${{ python_min }}
        - atomic-counter >=0.1.3
        - ccflow >=0.5.9,<1
        - colorlog
        - csp >=0.8.0,<1
        - deprecation
        - duckdb >=0.10,<1.4.1
        - fastapi >=0.110
        - fsspec
        - hydra-core
        - janus
        - omegaconf
        - orjson
        - perspective >=4,<4.1
        - psutil
        - pyarrow
        - pydantic >=2,<2.12
        - uvicorn >=0.28.1,<0.38
        - uvloop
        - websockets
        # Client
        - httpx
        - jsonref
        - nest-asyncio
        - packaging
    tests:
      - python:
          imports:
            - csp_gateway
            - csp_gateway.server
            - csp_gateway.client
          pip_check: true
          python_version: ${{ python_min }}.*
      - script:
          - csp-gateway-start --help
  - package:
      name: ${{ name|lower }}-client
    build:
      noarch: python
      script: python -m pip install . -vv --no-deps --no-build-isolation
    requirements:
      host:
        - python ${{ python_min }}.*
        - pip
        - hatchling
        - hatch-js
        - hatch-multi
        - pnpm
      run:
        - python >=${{ python_min }}
        - httpx
        - jsonref
        - nest-asyncio
        - packaging
        - pydantic >=2,<2.12
    tests:
      - python:
          imports:
            - csp_gateway
            - csp_gateway.client
          pip_check: false
          python_version: ${{ python_min }}.*

about:
  license: Apache-2.0
  license_file: LICENSE
  summary: Application framework built on CSP
  homepage: https://github.com/point72/csp-gateway
  repository: https://github.com/point72/csp-gateway

extra:
  recipe-maintainers:
    - arhamchopra
    - hintse
    - neejweej
    - ptomecek
    - timkpaine
