# yaml-language-server: $schema=https://raw.githubusercontent.com/prefix-dev/recipe-format/main/schema.json
schema_version: 1

context:
  version: "3.42.0"
  python_check_max: "3.14"

recipe:
  name: openmdao
  version: ${{ version }}

source:
  url: https://pypi.org/packages/source/o/openmdao/openmdao-${{ version }}.tar.gz
  sha256: 6eeb0629659cadf269b2fc13feef64fad0c76fdb9b4f3ba22d3467e14e4f5fd8

build:
  number: 0

outputs:
  - package:
      name: openmdao
    build:
      noarch: python
      script:
        - ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation --disable-pip-version-check
      python:
        entry_points:
          - openmdao = openmdao.utils.om:openmdao_cmd
          - reset_notebook = openmdao.devtools.docutils:reset_notebook_cmd
          - run_om_test = openmdao.devtools.run_test:run_test
          - webview = openmdao.utils.webview:webview_argv
          - wingproj = openmdao.devtools.wingproj:run_wing
    requirements:
      host:
        - hatchling
        - pip
        - python ${{ python_min }}.*
      run:
        - networkx >=3.3
        - numpy >=2.0,!=2.4.0
        - packaging
        - python >=${{ python_min }}
        - requests
        - scipy >=1.13
    tests:
      - python:
          imports: openmdao
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_check_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - openmdao --help
          - webview --help
          - wingproj --help

  - package:
      name: openmdao-with-doe
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("openmdao", exact=True) }}
        - pydoe3
    tests:
      - python:
          imports: openmdao
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_check_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - openmdao --help
          - webview --help
          - wingproj --help

  - package:
      name: openmdao-with-jax
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("openmdao", exact=True) }}
        - jax >=0.4.0
        - jaxlib >=0.4.0
    tests:
      - python:
          imports: openmdao
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_check_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - openmdao --help
          - webview --help
          - wingproj --help

  - package:
      name: openmdao-with-notebooks
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("openmdao", exact=True) }}
        - idna >=3.7
        - ipympl
        - notebook
    tests:
      - python:
          imports: openmdao
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_check_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - openmdao --help
          - webview --help
          - wingproj --help

  - package:
      name: openmdao-with-numba
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("openmdao", exact=True) }}
        - numba
    tests:
      - python:
          imports: openmdao
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_check_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - openmdao --help
          - webview --help
          - wingproj --help

  - package:
      name: openmdao-with-visualization
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("openmdao", exact=True) }}
        - bokeh >=3.4.0
        - colorama
        - matplotlib-base
        - panel
        - rich
    tests:
      - python:
          imports: openmdao
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_check_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - openmdao --help
          - webview --help
          - wingproj --help

  - package:
      name: openmdao-with-all
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("openmdao", exact=True) }}
        - ${{ pin_subpackage("openmdao-with-doe", exact=True) }}
        - ${{ pin_subpackage("openmdao-with-jax", exact=True) }}
        - ${{ pin_subpackage("openmdao-with-notebooks", exact=True) }}
        - ${{ pin_subpackage("openmdao-with-numba", exact=True) }}
        - ${{ pin_subpackage("openmdao-with-visualization", exact=True) }}
    tests:
      - python:
          imports: openmdao
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_check_max }}.*
      - files:
          recipe:
            - run_testflo.py
        requirements:
          run:
            - aiounittest
            - num2words
            - numpydoc >=1.1
            - parameterized
            - pycodestyle >=2.4.0
            - pydocstyle >=2.0.0
            - python ${{ python_min }}.*
            - testflo >=1.3.6
            - websockets >8
        script:
          - python run_testflo.py

about:
  license: Apache-2.0
  license_file: LICENSE.txt
  summary: OpenMDAO framework infrastructure
  description: |
    OpenMDAO is an open-source high-performance computing platform
    for systems analysis and multidisciplinary optimization, written in Python. It
    enables you to decompose your models, making them easier to build and maintain,
    while still solving them in a tightly coupled manner with efficient parallel
    numerical methods.
  homepage: https://openmdao.org
  repository: https://github.com/OpenMDAO/OpenMDAO
  documentation: https://openmdao.org/docs

extra:
  recipe-maintainers:
    - robfalck
    - swryan
    - bollwyvl
