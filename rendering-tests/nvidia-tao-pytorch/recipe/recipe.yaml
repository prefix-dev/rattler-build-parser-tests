schema_version: 1

context:
  name: nvidia-tao-pytorch
  version: 6.25.11

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  # Need to use commit hash because release tags are missing, see https://github.com/NVIDIA/tao_pytorch_backend/issues/41
  url: https://github.com/NVIDIA/tao_pytorch_backend/archive/5bd60a5005315941aaa7081332785018f5c51e8d.tar.gz # v6.25.11
  sha256: 504476a3937c1f653317557de2ddda6d014e16df46ab628cd36291b94efb8ac2

build:
  number: 1
  script:
    env:
      TORCH_CUDA_ARCH_LIST: "7.0 7.5 8.0 8.6 9.0 10.0 12.0+PTX"
    content:
      - ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
  skip:
    - cuda_compiler_version == "None" or not linux
  string: cuda_${{ cuda_compiler_version | version_to_buildstring }}py${{ python | version_to_buildstring }}h${{ hash }}_${{ build_number }}
requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ compiler('cuda') }}
    - ${{ stdlib('c') }}
    - libcublas-dev
    - libcusparse-dev
    - libcusolver-dev
  host:
    - pip
    - python
    - pytorch * cuda*
    - setuptools
  run:
    - python
    - pytorch * cuda*

tests:
  - python:
      imports:
        - nvidia_tao_pytorch.core
        - nvidia_tao_pytorch.cv
        - nvidia_tao_pytorch.pointcloud
        - nvidia_tao_pytorch.pruning
        - nvidia_tao_pytorch.sdg
        - nvidia_tao_pytorch.ssl
      pip_check: true

about:
  homepage: https://github.com/NVIDIA/tao_pytorch_backend
  summary: TAO Toolkit deep learning networks with PyTorch backend
  license: Apache-2.0
  license_file: LICENSE

extra:
  recipe-maintainers:
    - weiji14
