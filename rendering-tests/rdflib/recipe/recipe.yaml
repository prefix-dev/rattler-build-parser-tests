# yaml-language-server: $schema=https://raw.githubusercontent.com/prefix-dev/recipe-format/main/schema.json
schema_version: 1

context:
  version: "7.5.0"
  python_test_max: "3.14"

recipe:
  name: rdflib
  version: ${{ version }}

source:
  - url: https://pypi.org/packages/source/r/rdflib/rdflib-${{ version }}.tar.gz
    sha256: 663083443908b1830e567350d72e74d9948b310f827966358d76eebdc92bf592
    target_directory: dist
  - url: https://github.com/RDFLib/rdflib/archive/refs/tags/${{ version }}.tar.gz
    sha256: 37432dc75f39cfd373e0eb2d80122711d7f64ea6919854dd25352c6ffebcdc11
    target_directory: src

build:
  number: 0

outputs:
  - package:
      name: rdflib
    build:
      number: 0
      noarch: python
      script:
        - cd dist
        - ${{ PYTHON }} -m pip install . --no-deps -vv --no-build-isolation --disable-pip-version-check
      python:
        entry_points:
          - csv2rdf = rdflib.tools.csv2rdf:main
          - rdf2dot = rdflib.tools.rdf2dot:main
          - rdfgraphisomorphism = rdflib.tools.graphisomorphism:main
          - rdfpipe = rdflib.tools.rdfpipe:main
          - rdfs2dot = rdflib.tools.rdfs2dot:main
          - sq = rdflib.tools.sparqlquery:main
    requirements:
      host:
        - pip
        - poetry-core >=2.0.0
        - python ${{ python_min }}.*
      run:
        - isodate >=0.7.2,<1.0.0
        - pyparsing >=2.1.0,<4
        - python >=${{ python_min }}
    tests:
      - python:
          imports: rdflib
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_test_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - which csv2rdf              || where csv2rdf              || exit 1
          - which rdf2dot              || where rdf2dot              || exit 1
          - which rdfgraphisomorphism  || where rdfgraphisomorphism  || exit 1
          - which rdfpipe              || where rdfpipe              || exit 1
          - which rdfs2dot             || where rdfs2dot             || exit 1
          - which sq                   || where sq                   || exit 1

  - package:
      name: rdflib-with-networkx
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("rdflib", exact=True) }}
        - networkx >=2,<4
    tests:
      - python:
          imports: rdflib
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_test_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - python -c "from rdflib.extras.external_graph_libs import rdflib_to_networkx_graph; import rdflib; assert rdflib_to_networkx_graph(rdflib.Graph()) is not None"

  - package:
      name: rdflib-with-html
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("rdflib", exact=True) }}
        - html5rdf >=1.2.1,<2
    tests:
      - python:
          imports: rdflib
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_test_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - python -c "from rdflib import term; assert term.html5rdf"

  - package:
      name: rdflib-with-lxml
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("rdflib", exact=True) }}
        # see https://github.com/RDFLib/rdflib/pull/3219 (no changes)
        - lxml >=4.9.3,<7.0
    tests:
      - python:
          imports: rdflib
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_test_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - python -c "from rdflib.plugins.sparql.results import xmlresults; assert xmlresults.lxml_etree"

  - package:
      name: rdflib-with-orjson
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("rdflib", exact=True) }}
        - orjson >=3.9.14,<4
    tests:
      - python:
          imports: rdflib
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_test_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - python -c "from rdflib.plugins.sparql.results import jsonresults; assert jsonresults.orjson"

  - package:
      name: rdflib-with-rdf4j
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("rdflib", exact=True) }}
        - httpx >=0.28.1,<1
    tests:
      - python:
          imports: rdflib
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_test_max }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - python -c "from rdflib.contrib.rdf4j import client; assert client.httpx"

  - package:
      name: rdflib-with-all
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("rdflib-with-html", exact=True) }}
        - ${{ pin_subpackage("rdflib-with-lxml", exact=True) }}
        - ${{ pin_subpackage("rdflib-with-networkx", exact=True) }}
        - ${{ pin_subpackage("rdflib-with-orjson", exact=True) }}
        - ${{ pin_subpackage("rdflib-with-rdf4j", exact=True) }}
        - ${{ pin_subpackage("rdflib", exact=True) }}
    tests:
      - python:
          imports: rdflib
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_test_max }}.*

  - package:
      name: _rdflib-tests
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("rdflib-with-all", exact=True) }}
    tests:
      - python:
          imports: rdflib
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_test_max }}.*
      - files:
          source:
            - src/examples/
            - src/pyproject.toml
            - src/test/
        requirements:
          run:
            - pytest-cov
            - python ${{ python_min }}.*
            - setuptools
        script:
          file: run_rdflib_suite.py

about:
  license: BSD-3-Clause
  license_file: dist/LICENSE
  summary: RDFLib is a Python library for working with RDF, a simple yet powerful language for representing information.
  homepage: https://github.com/RDFLib/rdflib
  repository: https://github.com/RDFLib/rdflib
  documentation: https://rdflib.readthedocs.io

extra:
  feedstock-name: rdflib
  recipe-maintainers:
    - aucampia
    - satra
    - nicholascar
    - bollwyvl
