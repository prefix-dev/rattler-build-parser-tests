schema_version: 1

context:
  name: apache-airflow-providers-common-sql
  version: 1.30.3

recipe:
  name: ${{ name|lower }}-split
  version: ${{ version }}

source:
  url: https://pypi.org/packages/source/${{ name[0] }}/${{ name }}/apache_airflow_providers_common_sql-${{ version }}.tar.gz
  sha256: 91a301d906e05e2409d834b547822545025cbc2773e763df5546147fd48ec94f

build:
  number: 1

outputs:
  - package:
      name: ${{ name }}
    build:
      noarch: python
      script:
        file: install_airflow_providers_common_sql.sh
    requirements:
      host:
        - python ${{ python_min }}.*
        - flit-core ==3.12.0
        - pip
      run:
        - python >=${{ python_min }}
        - apache-airflow >=2.11.0
        - apache-airflow-providers-common-compat >=1.12.0
        - sqlparse >=0.5.1
        - more-itertools >=9.0.0
        - methodtools >=0.4.7
    tests:
      - python:
          imports:
            - airflow.providers.common.sql
          pip_check: true
          python_version: ${{ python_min }}.*
    # leaving out pandas[sql-other] extra for now because it is not there for python >=3.13
  - package:
      name: ${{ name }}-with-pandas
    build:
      noarch: python
    requirements:
      host:
        - python ${{ python_min }}.*
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage(name, upper_bound='x.x.x.x.x.x') }}
        # more restrictive for python >=3.13
        - pandas >=2.2.3
    tests:
      - python:
          imports:
            - airflow.providers.common.sql
          pip_check: true
          python_version: ${{ python_min }}.*
  - package:
      name: ${{ name }}-with-openlineage
    build:
      noarch: python
    requirements:
      host:
        - python ${{ python_min }}.*
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage(name, upper_bound='x.x.x.x.x.x') }}
        - apache-airflow-providers-openlineage
    tests:
      - python:
          imports:
            - airflow.providers.common.sql
          pip_check: true
          python_version: ${{ python_min }}.*
  - package:
      name: ${{ name }}-with-polars
    build:
      noarch: python
    requirements:
      host:
        - python ${{ python_min }}.*
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage(name, upper_bound='x.x.x.x.x.x') }}
        - polars >=1.26.0
    tests:
      - python:
          imports:
            - airflow.providers.common.sql
          pip_check: true
          python_version: ${{ python_min }}.*
  # Let's only add this if someone needs it
  # - package:
  #     name: ${{ name }}-with-sqlalchemy
  #   build:
  #     noarch: python
  #   requirements:
  #     host:
  #       - python ${{ python_min }}.*
  #     run:
  #       - python >=${{ python_min }}
  #       - ${{ pin_subpackage(name, upper_bound='x.x.x.x.x.x') }}
  #       - sqlalchemy >=1.4.49
  #   tests:
  #     - python:
  #         imports:
  #           - airflow.providers.common.sql
  #         pip_check: true
  #         python_version: ${{ python_min }}.*

about:
  summary: Provider package apache-airflow-providers-common-sql for Apache Airflow
  license: Apache-2.0
  license_file:
    - LICENSE
    - NOTICE
  homepage: https://github.com/apache/airflow/tree/main/providers/common/sql
  repository: https://github.com/apache/airflow/
  documentation: https://airflow.apache.org/docs/apache-airflow-providers-common-sql/stable/index.html

extra:
  recipe-maintainers:
    - xylar
