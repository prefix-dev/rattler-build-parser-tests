# yaml-language-server: $schema=https://raw.githubusercontent.com/prefix-dev/recipe-format/main/schema.json
schema_version: 1

context:
  version: "2.6.4"
  removed_in_python: "3.13"
  is_noop: ${{ "" if python_min == removed_in_python else "1" }}
  python_max: ${{ "4" if python_min == removed_in_python else removed_in_python }}
  python_check_max: ${{ "3.12" if is_noop else "3.14" }}
  expect_files: site-packages/cgi*.py

package:
  name: legacy-cgi
  version: ${{ version }}

source:
  url: https://pypi.org/packages/source/l/legacy-cgi/legacy_cgi-${{ version }}.tar.gz
  sha256: abb9dfc7835772f7c9317977c63253fd22a7484b5c9bbcdca60a29dcce97c577

build:
  number: 0
  noarch: python
  script:
    - ${{ PYTHON }} ${{ (RECIPE_DIR ~ "/patch_noop.py") if is_noop else "-v" }}
    - ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation --disable-pip-version-check

requirements:
  host:
    - hatchling
    - pip
    - python ${{ python_min }}.*
    - tomli
    - tomli-w
  run:
    - python >=${{ python_min }},<${{ python_max }}

tests:
  - package_contents:
      files:
        exists:
          - if: not is_noop
            then: ${{ expect_files }}
        not_exists:
          - if: is_noop
            then: ${{ expect_files }}
  - python:
      pip_check: true
      python_version:
        - ${{ python_min }}.*
        - ${{ python_check_max }}.*
      imports:
        - cgi
        - cgitb

about:
  homepage: https://github.com/jackrosenthal/legacy-cgi
  summary: Fork of the standard library cgi and cgitb modules, being deprecated in PEP-594
  license: PSF-2.0
  license_file: LICENSE

extra:
  recipe-maintainers:
    - bollwyvl
