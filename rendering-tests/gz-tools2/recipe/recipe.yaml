schema_version: 1

context:
  component_name: tools
  repo_name: ${{ "gz-" + component_name }}
  version: 2.0.3
  major_version: "2"  
  name: ${{ repo_name }}
  cxx_name: ${{ "lib" + name }}

recipe:
  name: ${{ name }}
  version: ${{ version }}

source:
  - url: https://github.com/gazebosim/${{ repo_name }}/archive/${{ repo_name }}${{ major_version }}_${{ version }}.tar.gz
    sha256: 1ad95ad989bf986ea1fcd76be6d25b5d08199aa0363073606ff2afc7d62e1c6c
    patches:
      - fix_backward_install.patch

build:
  number: 1

outputs:
  - package:
      name: ${{ cxx_name }}
    build:
      script:
        - if: unix
          then: build_cxx.sh
        - if: win
          then: bld_cxx.bat
    requirements:
      build:
        - ${{ compiler('cxx') }}
        - ${{ compiler('c') }}
        - ${{ stdlib('c') }}
        - ninja
        - cmake
        - pkg-config
      host:
        - libgz-cmake
        - backward-cpp
        - ruby
      run:
        - ruby
        - if: linux
          then:
            - elfutils
      run_exports:
        - ${{ pin_subpackage(cxx_name, upper_bound='x') }}
      ignore_run_exports:
        by_name:
          - ruby
          - libgz-cmake3
          - libgz-cmake4
          - libgz-cmake
        from_package:
          - libgz-cmake3
          - libgz-cmake4
          - libgz-cmake
    tests:
      - script:
          - if: not win
            then:
              - test -f ${PREFIX}/bin/gz
          - if: win
            then:
              - if not exist %PREFIX%\\Library\\bin\gz exit 1

  - package:
      name: ${{ name }}
    requirements:
      run:
        - ${{ pin_subpackage(cxx_name, exact=True) }}
      run_exports:
        - ${{ pin_subpackage(cxx_name, upper_bound='x') }}
    tests:
      - script:
          - if: not win
            then:
              - test -f ${PREFIX}/bin/gz
          - if: win
            then:
              - if not exist %PREFIX%\\Library\\bin\gz exit 1

  # In this package there was no major bump version for Jetty and the introduction of versionless packages, 
  # so the actual packages are versionless, and the old versioned packages are just aliases to the versionless ones.
  - package:
      name: libgz-tools2
    requirements:
      run:
        - ${{ pin_subpackage(cxx_name, exact=true) }}
      run_exports:
        - ${{ pin_subpackage(cxx_name, upper_bound='x') }}
        - ${{ pin_subpackage('libgz-tools', upper_bound='x') }}
    tests:
      - script:
          - if: not win
            then:
              - test -f ${PREFIX}/bin/gz
          - if: win
            then:
              - if not exist %PREFIX%\\Library\\bin\gz exit 1

  - package:
      name: gz-tools2
    requirements:
      run:
        - ${{ pin_subpackage(name, exact=true) }}
      run_exports:
        - ${{ pin_subpackage(cxx_name, upper_bound='x') }}
        - ${{ pin_subpackage('libgz-tools', upper_bound='x') }}
    tests:
      - script:
          - if: not win
            then:
              - test -f ${PREFIX}/bin/gz
          - if: win
            then:
              - if not exist %PREFIX%\\Library\\bin\gz exit 1

about:
  homepage: https://github.com/gazebosim/gz-tools
  license: Apache-2.0
  license_file: LICENSE
  summary: Command line tools for the Gazebo libraries.

extra:
  feedstock-name: ${{ repo_name }}
  recipe-maintainers:
    - wolfv
    - traversaro
    - j-rivero
